webpackJsonp([1],{NHnr:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("7+uW"),a={render:function(){var t=this.$createElement,i=this._self._c||t;return i("div",{attrs:{id:"app"}},[i("router-view")],1)},staticRenderFns:[]},o=e("VU/8")({name:"app"},a,!1,function(t){e("oxFC")},null,null).exports,r=e("/ocq"),s=e("Dd8w"),c=e.n(s),l=e("fZjL"),d=e.n(l),u={Folder:AV.Object.extend("Folder"),Artical:AV.Object.extend("Artical"),updateFolder:function(t){var i=void 0;return i=t.id?AV.Object.createWithoutData("Folder",t.id):new this.Folder,t.del?i.destroy():(i.set("name",t.name),i.save())},updateArtical:function(t){var i=void 0;return i=t.id?AV.Object.createWithoutData("Artical",t.id):new this.Artical,-1===t.status?i.destroy():(d()(t).forEach(function(e){"id"!==e&&i.set(e,t[e])}),i.save())},getList:function(t,i){var e=new AV.Query(t);return i&&d()(i).forEach(function(t){e.equalTo(t,i[t])}),e.descending("createdAt"),e.find()},signUp:function(){var t=new AV.User;t.setUsername("jmingzi"),t.setPassword("ck.123456"),t.setEmail("472102644@qq.com"),t.signUp().then(function(t){console.log(t)},function(t){})},currentUser:function(){return AV.User.current()},logOut:function(){return AV.User.logOut()},login:function(t,i){return AV.User.logIn(t,i)}},p={name:"editor",data:function(){return{articalTitle:"",editorInstance:!1,showLeftMenu:[],path:[],isAddFolder:!1,isEditFolder:!1,newFolderName:"新建目录",savePath:null,saveArtical:null}},created:function(){var t=this;window.editorLoadCallback||(window.editorLoadCallback=function(i){console.log("editor load callback"),t.editorInstance=i})},computed:{isAdmin:function(){return"Editor"===this.$route.name},frameUrl:function(){return(8080===Number(location.port)?"//localhost:8080/dist/my-editor/index.html":"./my-editor/index.html")+(this.isAdmin?"":"?preview=1")}},mounted:function(){var t=this;u.getList("Folder").then(function(i){t.path=t.getAttribute(i)})},methods:{getAttribute:function(t){return t.map(function(t){return c()({},t.attributes,{id:t.id})})},publish:function(t){var i=this;if(this.checkPriv(),this.editorInstance){var e={status:t,artical_title:this.articalTitle,artical_thumb:"",artical_content:this.editorInstance.getHTML(),artical_markdown:this.editorInstance.getMarkdown(),artical_folder:c()({},this.savePath,{artical:[]})};this.saveArtical&&(e.id=this.saveArtical.id),u.updateArtical(e).then(function(t){if(t.id){alert((e.id?"编辑":"新增")+"成功");var n=c()({id:t.id},e);if(e.id){var a=i.savePath.artical.findIndex(function(t){return t.id===e.id});i.$set(i.savePath.artical,a,n)}else if(i.savePath.artical)i.savePath.artical.unshift(n);else{i.$set(i.savePath,"artical",[n]);var o=i.path.findIndex(function(t){return t.id===i.savePath.id});i.toggle(o,i.savePath)}}})}else alert("editor未初始化")},setArticalFill:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.editorInstance?(console.log("editor instance is exist"),this.$refs.frame.contentWindow.Editor.setValue(i.artical_markdown||"")):(console.log("editor has no instance"),localStorage.setItem("editFillContent",i.artical_markdown||"")),this.savePath=t,this.saveArtical=i,this.articalTitle=i.artical_title||""},toggle:function(t,i){var e=this;this.showLeftMenu[t]||i.artical||u.getList("Artical",{"artical_folder.id":i.id}).then(function(t){e.$set(i,"artical",e.getAttribute(t))}),this.$set(this.showLeftMenu,t,!this.showLeftMenu[t])},selectPath:function(t){this.isAdmin&&(this.isEditFolder?console.log("请先编辑完成"):(this.setArticalFill(t),this.saveArtical=null))},confirmAddFolder:function(){var t=this;if(this.newFolderName){var i={name:this.newFolderName};this.isEditFolder&&(i.id=this.savePath.id),u.updateFolder(i).then(function(e){console.log(e.id),e.id&&(t.isEditFolder?t.savePath.name=i.name:t.path.unshift(c()({},i,{id:e.id})),t.cancelAddFolder(),alert("操作成功"))})}else alert("请输入目录名称")},cancelAddFolder:function(){this.isAddFolder=!1,this.isEditFolder=!1,this.newFolderName="新建目录"},addFolder:function(){this.checkPriv(),this.isEditFolder?alert("请先编辑完成"):this.isAddFolder=!0},editCurrFolder:function(){this.checkPriv(),this.isAddFolder?alert("请先新建完成"):(this.isEditFolder=!0,this.newFolderName=this.savePath.name)},delFolder:function(){var t=this;this.checkPriv();var i=this.path.findIndex(function(i){return i.id===t.savePath.id});void 0!==this.showLeftMenu[i]?this.savePath.artical&&this.savePath.artical.length>0?alert("请先删除该目录下的文章"):u.updateFolder(c()({},this.savePath,{del:!0})).then(function(e){e.id&&(t.path.splice(i,1),t.showLeftMenu[i]=!1)}):alert("请先查看该目录下是否存在文章")},delArtical:function(t,i){var e=this;this.checkPriv(),u.updateArtical(c()({},t,{status:-1})).then(function(n){if(n.id){var a=e.path[i].artical.findIndex(function(i){return i.id===t.id});e.path[i].artical.splice(a,1),e.$set(e.path,i,e.path[i]),alert("删除成功")}})},logOut:function(){var t=this;u.logOut().then(function(i){i?t.$router.push("/login"):alert(i.error)})},checkPriv:function(){this.isAdmin||this.$router.replace("/editor")}}},h={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"wrap"},[e("div",{staticClass:"w200 left-menu position-a left-0 top-0 px-bottom-50 bd-ccc-r"},[e("ul",{staticClass:"menu-top"},[e("li",{staticClass:"position-r px-font-16 px-line-50 px-height-50 bd-ccc-b"},[t.isAdmin?e("div",{staticClass:"width-100 height-100 hover-bg text-center color-folder",on:{click:function(i){i.stopPropagation(),t.addFolder(i)}}},[e("i",{staticClass:"iconfont icon-add"}),t._v(" "),e("span",[t._v("新建目录")])]):e("div",{staticClass:"width-100 height-100 hover-bg text-center color-info",on:{click:function(i){t.$router.push("/editor")}}},[e("i",{staticClass:"iconfont icon-shenpi_faqishenpi"}),t._v(" "),e("span",[t._v("写作模式")])])]),t._v(" "),e("li",{directives:[{name:"show",rawName:"v-show",value:t.isAddFolder,expression:"isAddFolder"}],class:"px-font-14 px-padding-10"},[e("i",{staticClass:"iconfont icon-queding fr color-c999 px-margin-t5",on:{click:function(i){i.stopPropagation(),t.confirmAddFolder(i)}}}),t._v(" "),e("i",{staticClass:"iconfont icon-guanbi fr color-c999 px-margin-5",on:{click:function(i){i.stopPropagation(),t.cancelAddFolder(i)}}}),t._v(" "),e("i",{staticClass:"iconfont icon-CombinedShape1 color-folder"}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.newFolderName,expression:"newFolderName",modifiers:{trim:!0}}],staticClass:"new-folder-input",attrs:{type:"text",maxlength:"10"},domProps:{value:t.newFolderName},on:{input:function(i){i.target.composing||(t.newFolderName=i.target.value.trim())},blur:function(i){t.$forceUpdate()}}})]),t._v(" "),t._l(t.path,function(i,n){return[e("li",{key:i.id,class:"px-font-16 px-padding-10 "+(t.savePath&&t.savePath.id===i.id?"bg-f2":""),on:{click:function(e){e.stopPropagation(),t.selectPath(i)}}},[t.isEditFolder&&t.savePath.id===i.id?[e("i",{staticClass:"iconfont icon-queding fr color-c999 px-margin-t5",on:{click:function(i){i.stopPropagation(),t.confirmAddFolder(i)}}}),t._v(" "),e("i",{staticClass:"iconfont icon-guanbi fr color-c999 px-margin-5",on:{click:function(i){i.stopPropagation(),t.cancelAddFolder(i)}}})]:e("i",{class:"iconfont px-font-10 px-margin-t5 color-ccc fr "+(t.showLeftMenu[n]?"icon-jiantou":"icon-Triangle"),on:{click:function(e){e.stopPropagation(),t.toggle(n,i)}}}),t._v(" "),e("i",{staticClass:"iconfont icon-CombinedShape1 color-folder"}),t._v(" "),t.isEditFolder&&t.savePath.id===i.id?e("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.newFolderName,expression:"newFolderName",modifiers:{trim:!0}}],staticClass:"new-folder-input px-font-14",attrs:{type:"text",maxlength:"20"},domProps:{value:t.newFolderName},on:{input:function(i){i.target.composing||(t.newFolderName=i.target.value.trim())},blur:function(i){t.$forceUpdate()}}}):e("span",[t._v(t._s(i.name))])],2),t._v(" "),e("ul",{directives:[{name:"show",rawName:"v-show",value:t.showLeftMenu[n],expression:"showLeftMenu[index]"}]},[i.artical?[t._l(i.artical,function(a){return e("li",{key:a.id,staticClass:"hover-bg",on:{click:function(e){e.stopPropagation(),t.setArticalFill(i,a)}}},[e("i",{class:"iconfont icon-zhinan "+(0===a.status?"color-file":"color-green")}),t._v(" "),t.isAdmin?e("i",{staticClass:"fr iconfont icon-yishanchu color-c999",on:{click:function(i){i.stopPropagation(),t.delArtical(a,n)}}}):t._e(),t._v(" "),e("span",[t._v(t._s(a.artical_title))])])}),t._v(" "),0===i.artical.length?e("li",{staticClass:"hover-bg"},[t._v("还没有文章")]):t._e()]:t._e()],2)]})],2)]),t._v(" "),e("div",{staticClass:"right-content position-a right-0 top-0 bottom-0"},[e("div",{staticClass:"title bd-ccc-b cl px-font-14 px-height-50"},[t.isAdmin&&t.savePath?[e("div",{staticClass:"fr px-line-50 text-center px-margin-r10"},[e("div",{staticClass:"btn px-btn btn-error line-normal cursor-p",on:{click:function(i){t.publish(1)}}},[t._v("发布")])]),t._v(" "),e("div",{staticClass:"fr px-line-50 text-center px-margin-r10",on:{click:function(i){t.publish(0)}}},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.saveArtical||1!==t.saveArtical.status,expression:"saveArtical ? saveArtical.status !== 1 : true "}],staticClass:"btn px-btn btn-aaa line-normal btn-inverse cursor-p"},[t._v("保存到草稿")])]),t._v(" "),e("div",{staticClass:"fr px-line-50 text-right w200 over-text px-margin-r10"},[e("span",[t._v(t._s(t.savePath.name))]),t._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:!t.isEditFolder,expression:"!isEditFolder"}]},[e("span",[t._v("/")]),t._v(" "),e("span",{staticClass:"color-info cursor-p",on:{click:t.editCurrFolder}},[t._v("编辑")]),t._v(" "),e("span",[t._v("/")]),t._v(" "),e("span",{staticClass:"color-error cursor-p",on:{click:t.delFolder}},[t._v("删除")])])])]:t._e(),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.articalTitle,expression:"articalTitle",modifiers:{trim:!0}}],staticClass:"height-100 px-padding-lr10 px-font-16",attrs:{type:"text",disabled:!t.isAdmin,placeholder:t.isAdmin?t.savePath?"请输入标题":"从选择一个目录开始":"过往不恋、当下不杂、未来不迎..."},domProps:{value:t.articalTitle},on:{input:function(i){i.target.composing||(t.articalTitle=i.target.value.trim())},blur:function(i){t.$forceUpdate()}}})],2),t._v(" "),e("div",{staticClass:"position-a px-top-60 px-bottom-10 width-100"},[t.savePath?e("iframe",{ref:"frame",attrs:{src:t.frameUrl,frameborder:"0",height:"100%",width:"100%"}}):e("div",{staticClass:"text-center px-padding-t100"},[e("p",{staticClass:"px-font-32 px-padding-t100"},[t._v("Hey, boy !")]),t._v(" "),e("span",{staticClass:"color-c666"},[t._v("世界在你手上...")])])])]),t._v(" "),e("div",{staticClass:"position-a text-center left-0 w200 bottom-0 bd-ccc-r px-height-50 overflow-h"},[t.isAdmin?e("a",{staticClass:"display-b bd-ccc-t px-line-50 width-50 fl",attrs:{href:"javascript:"},on:{click:t.logOut}},[t._v("退出登录")]):t._e(),t._v(" "),t.isAdmin?e("a",{staticClass:"display-b bd-ccc-t px-line-50 width-50 fl",attrs:{href:"javascript:"},on:{click:function(i){t.$router.replace("/")}}},[t._v("阅读模式")]):t._e()])])},staticRenderFns:[]},f=e("VU/8")(p,h,!1,function(t){e("hj4E")},null,null).exports,v={data:function(){return{name:"",pwd:""}},methods:{login:function(){var t=this;this.name&&this.pwd?u.login(this.name,this.pwd).then(function(i){i.code?alert(i.error):t.$router.push("/editor")}).then(function(t){console.log(t)}):alert("请输入信息")}}},m={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"w200 login-wrap bd-ccc px-padding-20"},[e("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.name,expression:"name",modifiers:{trim:!0}}],attrs:{type:"text"},domProps:{value:t.name},on:{keyup:function(i){if(!("button"in i)&&13!==i.keyCode)return null;t.login(i)},input:function(i){i.target.composing||(t.name=i.target.value.trim())},blur:function(i){t.$forceUpdate()}}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.pwd,expression:"pwd",modifiers:{trim:!0}}],attrs:{type:"password"},domProps:{value:t.pwd},on:{keyup:function(i){if(!("button"in i)&&13!==i.keyCode)return null;t.login(i)},input:function(i){i.target.composing||(t.pwd=i.target.value.trim())},blur:function(i){t.$forceUpdate()}}}),t._v(" "),e("div",{staticClass:"text-center"},[e("a",{staticClass:"btn px-btn btn-info px-margin-b10",attrs:{href:"javascript:"},on:{click:t.login}},[t._v("登录")]),e("br"),t._v(" "),e("a",{attrs:{href:"#/"}},[t._v("阅读模式")])])])},staticRenderFns:[]},g=e("VU/8")(v,m,!1,function(t){e("ORHx")},"data-v-4b1eeeea",null).exports;n.a.use(r.a);var w=new r.a({routes:[{path:"/",name:"Index",component:f},{path:"/editor",name:"Editor",component:f,meta:{auth:!0}},{path:"/login",name:"Login",component:g}]});w.beforeEach(function(t,i,e){if(t.matched.some(function(t){return t.meta.auth})){u.currentUser()?e():e("/login")}else e()});var x=w;n.a.config.productionTip=!1;AV.init({appId:"UjPTkcNRB9HL7458RuG6f8xk-gzGzoHsz",appKey:"ylcamdRnbp8FyA7CoDAL5BSz"}),new n.a({el:"#app",router:x,template:"<App/>",components:{App:o}})},ORHx:function(t,i){},hj4E:function(t,i){},oxFC:function(t,i){}},["NHnr"]);
//# sourceMappingURL=app.efb4206367e71801ee3d.js.map